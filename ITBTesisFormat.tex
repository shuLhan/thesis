%%
%% This contain formatting for ITB Thesis.
%%

%%
%% Set page margin to 4cm left, 3cm on top, right, and bottom.
%%
\geometry{
	a4paper,
	top=3cm,
	right=3cm,
	bottom=3cm,
	left=4cm
}

%%
%% Set space between paragraphs to 1.5.
%%
\setlength{\parskip}{1.5em}

%%
%% Add dot to TOC.
%%
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\contentsname}{}

%%
%% Reduce vspace between title in list and body
%%
\addto\captionsbahasa{
\renewcommand{\contentsname}{
	\chapter*{\vspace{0em}\daftarisi}
	\vspace{-1.5em}
	\addcontentsline{toc}{chapter}{\daftarisi}
}}

\newcommand{\listappendixname}{
	\chapter*{\vspace{0em}\tupdaftarlampiran}
	\vspace{-1.5em}
	\addcontentsline{toc}{chapter}{\tupdaftarlampiran}
}

\addto\captionsbahasa{
\renewcommand{\listfigurename}{
	\chapter*{\vspace{0em}\daftargambar}
	\vspace{-1.5em}
	\addcontentsline{toc}{chapter}{\daftargambar}
}}

\addto\captionsbahasa{
\renewcommand{\listtablename}{
	\chapter*{\vspace{0em}\daftartabel}
	\vspace{-1.5em}
	\addcontentsline{toc}{chapter}{\daftartabel}
}}

%%
%% Source code listing style.
%%
\lstset{
	basicstyle=\scriptsize\ttfamily
,	breaklines=true
,	stringstyle=\scriptsize\ttfamily
,	numbers=left
,	numberstyle=\tiny\ttfamily
,	numbersep=5pt
,	tabsize=4
,	frame=single
}

\makeatletter
\def\lst@lettertrue{\let\lst@ifletter\iffalse}
\makeatother

%%
%% Format chapter and section.
%%

\setlength{\cftchapnumwidth}{5em}
\setlength{\cftsecnumwidth}{2.5em}

\setlength{\cftsecindent}{5em}
\setlength{\cftsubsecindent}{7.5em}

\renewcommand{\cftchappresnum}{Bab\space}

%% Set chapter name to Bab.
\titleformat{\chapter}[hang]
{\bfseries\large\centering\vspace{-1.5em}}
{Bab \thechapter}
{1em}
{}

%% Set section font to normal.
\titleformat{\section}
{\normalfont\bfseries}
{\thesection}
{1em}{}

%% Set subsection font to normal.
\titleformat{\subsection}
{\normalfont\bfseries}
{\thesubsection}
{1em}{}

%% Set spacing for chapter, section, and subsection.
\titlespacing{\chapter}{0pt}{0pt}{0pt}
\titlespacing*{\chapter}{0pt}{0pt}{1.5em}
\titlespacing{\section}{0pt}{0pt}{-1em}
\titlespacing{\subsection}{0pt}{0pt}{-1em}

%% Set roman on chapter number.
\def\thechapter{\Roman{chapter}}

%% Alter latex default title on table and figure.
\captionsetup[table]{name=Tabel}
\captionsetup[figure]{name=Gambar}

%%
\renewcommand{\arraystretch}{1.5}
\setlength{\tabcolsep}{3pt}

%% Change bibliography title.
\defbibheading{bibliography}{\centerline{
	\textbf{DAFTAR PUSTAKA}}
}

%% Algorithmicx
\makeatletter
\renewcommand{\ALG@beginalgorithmic}{\footnotesize}
\makeatother

%% My bibligraphy file
\addbibresource{bibliography.bib}

%% multicolumn setting
\setlength{\columnsep}{1cm}

%% uncomment this to show overrule in black box
\overfullrule=2cm

%% The Glory Appendices

\newlistof{appendix}{app}{\listappendixname}
\setcounter{appdepth}{2}
\renewcommand{\theappendix}{\Alph{appendix}}
\renewcommand{\cftappendixpresnum}{Lampiran\space}
\setlength{\cftbeforeappendixskip}{0em}
\setlength{\cftappendixnumwidth}{6em}
\newlistentry[appendix]{subappendix}{app}{1}
\renewcommand{\thesubappendix}{\theappendix.\arabic{subappendix}}
\setlength{\cftsubappendixindent}{6em}

\newcommand{\myappendix}[1]{%
	\refstepcounter{appendix}%
	\chapter*{Lampiran\space\theappendix\space #1}%
	\addcontentsline{app}{appendix}{\protect\numberline{\theappendix}#1}%
	\par
}

\newcommand{\subappendix}[1]{%
	\refstepcounter{subappendix}%
	\section*{\thesubappendix\space #1}%
	\addcontentsline{app}{subappendix}{\protect\numberline{\thesubappendix}#1}%
}

%% Format TOC
\makeatletter
	\newskip\old@cftbeforechapskip
	\old@cftbeforechapskip\cftbeforechapskip
	\let\old@l@chapter\l@chapter
	\let\old@l@section\l@section
	\def\l@chapter#1#2{\old@l@chapter{#1}{#2}\cftbeforechapskip2pt}% set your value here
	\def\l@section#1#2{\old@l@section{#1}{#2}\cftbeforechapskip\old@cftbeforechapskip}
\makeatother

%% Set default line spacing to 1.5
\onehalfspacing

\DefineBibliographyStrings{bahasa}{
	and			= {dan}
,	andothers	= {dkk.}
}

\setcounter{smartand}{2}

%% Replace ampersand in bibliography with 'and'
\AtBeginBibliography{\renewcommand*{\finalnamedelim}{%
		\ifthenelse{\value{listcount}>\maxprtauth}
			{}
			{\ifthenelse{\value{liststop}>2}
				{\finalandcomma\addspace\bibstring{and}\space}
				{\addspace\bibstring{and}\space}}}}

%% Replace ampersand in citation with 'and'
\AtEveryCitekey{\renewcommand*{\finalnamedelim}{%
		\ifthenelse{\value{listcount}>\maxprtauth}
			{}
			{\ifthenelse{\value{liststop}>2}
				{\finalandcomma\addspace\bibstring{and}\space}
				{\addspace\bibstring{and}\space}}}}

\xpatchnameformat{labelname}
	{\ifciteseen}{\ifnumcomp{\value{listtotal}}{>}{\value{maxnames}}}{}{}

\appto{\bibsetup}{\emergencystretch=0.5em}
